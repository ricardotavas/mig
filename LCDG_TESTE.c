/*----------------------------------------------------------------------------
 *      Biblioteca:	LPC176x_LCD.lib
 *      Proposito:	Biblioteca com funções para LCD
 *----------------------------------------------------------------------------
 *      Arquivo:    LCDG_128x64.c
 *      Proposito: 	Funções para LCD gráfico de 128x64 dots
 *----------------------------------------------------------------------------
 *      Versão: 	1.00 	Prog: Ricardo T.   Data: 25/04/2013
 * 		Descrição:  Versão inicial
 *----------------------------------------------------------------------------
 *      Este código pertence a Wyma Tecnologia e Sistemas LTDA.
 *---------------------------------------------------------------------------*/

#include	<stdio.h>
#include 	"LCD_BASE.h"

/*----------------------------------------------------------------------------
 *      Tabela de caracteres
 *---------------------------------------------------------------------------*/

static const unsigned char TabelaASC [224][6]={
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 32
0x00,0x00,0x4F,0x00,0x00, 0x00,	// !	- 33
0x00,0x07,0x00,0x07,0x00, 0x00,	// "	- 34
0x14,0x7F,0x14,0x7F,0x14, 0x00,	// #	- 35
0x24,0x2A,0x7F,0x2A,0x12, 0x00,	// $	- 36
0x23,0x13,0x08,0x64,0x62, 0x00,	// %	- 37
0x36,0x49,0x55,0x22,0x50, 0x00,	// &	- 38
0x00,0x05,0x03,0x00,0x00, 0x00,	// '	- 39
0x00,0x1C,0x22,0x41,0x00, 0x00,	// (	- 40
0x00,0x41,0x22,0x1C,0x00, 0x00,	// )	- 41
0x14,0x08,0x3E,0x08,0x14, 0x00,	// *	- 42
0x08,0x08,0x3E,0x08,0x08, 0x00,	// +	- 43
0x00,0x50,0x60,0x00,0x00, 0x00,	// ,	- 44
0x08,0x08,0x08,0x08,0x08, 0x00,	// -	- 45
0x00,0x60,0x60,0x00,0x00, 0x00,	// .	- 46
0x20,0x10,0x08,0x04,0x02, 0x00,	// /	- 47
0x3E,0x51,0x49,0x45,0x3E, 0x00,	// 0	- 48
0x00,0x42,0x7F,0x40,0x00, 0x00,	// 1	- 49
0x42,0x61,0x51,0x49,0x46, 0x00,	// 2	- 50
0x21,0x41,0x45,0x4B,0x31, 0x00,	// 3	- 51
0x18,0x14,0x12,0x7F,0x10, 0x00,	// 4	- 52
0x27,0x45,0x45,0x45,0x39, 0x00,	// 5	- 53
0x3C,0x4A,0x49,0x49,0x30, 0x00,	// 6	- 54
0x01,0x71,0x09,0x05,0x03, 0x00,	// 7	- 55
0x36,0x49,0x49,0x49,0x36, 0x00,	// 8	- 56
0x06,0x49,0x49,0x29,0x1E, 0x00,	// 9	- 57
0x00,0x36,0x36,0x00,0x00, 0x00,	// :	- 58
0x00,0x56,0x36,0x00,0x00, 0x00,	// ;	- 59
0x08,0x14,0x22,0x41,0x00, 0x00,	// <	- 60
0x14,0x14,0x14,0x14,0x14, 0x00,	// =	- 61
0x00,0x41,0x22,0x14,0x08, 0x00,	// >	- 62
0x02,0x01,0x51,0x09,0x06, 0x00,	// ?	- 63
0x32,0x49,0x79,0x41,0x3E, 0x00,	// @	- 64
0x7E,0x09,0x09,0x09,0x7E, 0x00,	// A	- 65
0x7F,0x49,0x49,0x49,0x36, 0x00,	// B	- 66
0x3E,0x41,0x41,0x41,0x22, 0x00,	// C	- 67
0x7F,0x41,0x41,0x22,0x1C, 0x00,	// D	- 68
0x7F,0x49,0x49,0x49,0x41, 0x00,	// E	- 69
0x7F,0x09,0x09,0x09,0x01, 0x00,	// F	- 70
0x3E,0x41,0x49,0x49,0x7A, 0x00,	// G	- 71
0x7F,0x08,0x08,0x08,0x7F, 0x00,	// H	- 72
0x00,0x41,0x7F,0x41,0x00, 0x00,	// I	- 73
0x20,0x40,0x41,0x3F,0x01, 0x00,	// J	- 74
0x7F,0x08,0x14,0x22,0x41, 0x00,	// K	- 75
0x7F,0x40,0x40,0x40,0x40, 0x00,	// L	- 76
0x7F,0x02,0x0C,0x02,0x7F, 0x00,	// M	- 77
0x7F,0x04,0x08,0x10,0x7F, 0x00,	// N	- 78
0x3E,0x41,0x41,0x41,0x3E, 0x00,	// O	- 79
0x7F,0x09,0x09,0x09,0x06, 0x00,	// P	- 80
0x3E,0x41,0x51,0x21,0x5E, 0x00,	// Q	- 81
0x7F,0x09,0x19,0x29,0x46, 0x00,	// R	- 82
0x46,0x49,0x49,0x49,0x31, 0x00,	// S	- 83
0x01,0x01,0x7F,0x01,0x01, 0x00,	// T	- 84
0x3F,0x40,0x40,0x40,0x3F, 0x00,	// U	- 85
0x1F,0x20,0x40,0x20,0x1F, 0x00,	// V	- 86
0x3F,0x40,0x38,0x40,0x3F, 0x00,	// W	- 87
0x63,0x14,0x08,0x14,0x63, 0x00,	// X	- 88
0x07,0x08,0x70,0x08,0x07, 0x00,	// Y	- 89
0x61,0x51,0x49,0x45,0x43, 0x00,	// Z	- 90
0x00,0x7F,0x41,0x41,0x00, 0x00,	// [	- 91
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 92
0x00,0x41,0x41,0x7F,0x00, 0x00,	// ]	- 93
0x04,0x02,0x01,0x02,0x04, 0x00,	// ^	- 94
0x40,0x40,0x40,0x40,0x40, 0x00,	// _	- 95
0x00,0x01,0x02,0x04,0x00, 0x00,	// `	- 96
0x20,0x54,0x54,0x54,0x78, 0x00,	// a	- 97
0x7F,0x48,0x44,0x44,0x38, 0x00,	// b	- 98
0x38,0x44,0x44,0x44,0x20, 0x00,	// c	- 99
0x38,0x44,0x44,0x48,0x7F, 0x00,	// d	- 100
0x38,0x54,0x54,0x54,0x18, 0x00,	// e	- 101
0x08,0x7E,0x09,0x01,0x02, 0x00,	// f	- 102
0x0C,0x52,0x52,0x52,0x3E, 0x00,	// g	- 103
0x7F,0x08,0x04,0x04,0x78, 0x00,	// h	- 104
0x00,0x44,0x7D,0x40,0x00, 0x00,	// i	- 105
0x20,0x40,0x44,0x3D,0x00, 0x00,	// j	- 106
0x7F,0x10,0x28,0x44,0x00, 0x00,	// k	- 107
0x00,0x41,0x7F,0x40,0x00, 0x00,	// l	- 108
0x7C,0x04,0x18,0x04,0x78, 0x00,	// m	- 109
0x7C,0x08,0x04,0x04,0x78, 0x00,	// n	- 110
0x38,0x44,0x44,0x44,0x38, 0x00,	// o	- 111
0x7C,0x14,0x14,0x14,0x08, 0x00,	// p	- 112
0x08,0x14,0x14,0x18,0x7C, 0x00,	// q	- 113
0x7C,0x08,0x04,0x04,0x08, 0x00,	// r	- 114
0x48,0x54,0x54,0x54,0x20, 0x00,	// s 	- 115
0x04,0x3F,0x44,0x40,0x20, 0x00,	// t 	- 116
0x3C,0x40,0x40,0x20,0x7C, 0x00,	// u	- 117
0x1C,0x20,0x40,0x20,0x1C, 0x00,	// v	- 118
0x3C,0x40,0x30,0x40,0x3C, 0x00,	// w	- 119
0x44,0x28,0x10,0x28,0x44, 0x00,	// x	- 120
0x0C,0x50,0x50,0x50,0x3C, 0x00,	// y	- 121
0x44,0x64,0x54,0x4C,0x44, 0x00,	// z	- 122
0x00,0x08,0x36,0x41,0x00, 0x00,	// {	- 123
0x00,0x00,0x7F,0x00,0x00, 0x00,	// |	- 124
0x00,0x41,0x36,0x08,0x00, 0x00,	// }	- 125
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 126
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 127
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 128
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 129
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 130
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 131
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 132
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 133
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 134
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 135
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 136
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 137
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 138
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 139
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 140
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 141
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 142
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 143
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 144
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 145
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 146
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 147
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 148
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 149
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 150
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 151
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 152
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 153
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 154
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 155
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 156
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 157
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 158
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 159
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 160
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 161
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 162
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 163
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 164
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 165
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 166
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 167
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 168
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 169
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 170
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 171
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 172
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 173
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 174
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 175
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 176
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 177
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 178
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 179
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 180
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 181
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 182							   
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 183
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 184
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 185
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 186
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 187
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 188
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 189
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 190
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 191
0x7E,0x09,0x09,0x09,0x7E, 0x00,	// A 	- 192
0x78,0x14,0x16,0x15,0x78, 0x00,	// Á	- 193
0x7E,0x09,0x09,0x09,0x7E, 0x00,	// A 	- 194
0x78,0x15,0x15,0x15,0x78, 0x00,	// Ã	- 195
0x7E,0x09,0x09,0x09,0x7E, 0x00,	// A 	- 196
0x7E,0x09,0x09,0x09,0x7E, 0x00,	// A 	- 197
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 198
0x3E,0x41,0xE1,0x41,0x22, 0x00,	// Ç  	- 199
0x7F,0x49,0x49,0x49,0x41, 0x00,	// E 	- 200
0x7F,0x49,0x49,0x49,0x41, 0x00,	// E 	- 201
0x7F,0x49,0x49,0x49,0x41, 0x00,	// E	- 202
0x7F,0x49,0x49,0x49,0x41, 0x00,	// E 	- 203
0x00,0x41,0x7F,0x41,0x00, 0x00,	// I 	- 204
0x00,0x41,0x7F,0x41,0x00, 0x00,	// I 	- 205
0x00,0x41,0x7F,0x41,0x00, 0x00,	// I 	- 206
0x00,0x41,0x7F,0x41,0x00, 0x00,	// I 	- 207
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 208
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 209
0x3E,0x41,0x41,0x41,0x3E, 0x00,	// O 	- 210
0x3E,0x41,0x41,0x41,0x3E, 0x00,	// O 	- 211
0x3E,0x41,0x41,0x41,0x3E, 0x00,	// O 	- 212
0x3E,0x41,0x41,0x41,0x3E, 0x00,	// O 	- 213
0x3E,0x41,0x41,0x41,0x3E, 0x00,	// O 	- 214
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 215
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 216
0x3F,0x40,0x40,0x40,0x3F, 0x00,	// U 	- 217
0x3F,0x40,0x40,0x40,0x3F, 0x00,	// U 	- 218
0x3F,0x40,0x40,0x40,0x3F, 0x00,	// U 	- 219
0x3F,0x40,0x40,0x40,0x3F, 0x00,	// U 	- 220
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 221
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 222
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 223
0x20,0x54,0x54,0x54,0x78, 0x00,	// a 	- 224
0x20,0x54,0x54,0x54,0x78, 0x00,	// a 	- 225
0x20,0x54,0x54,0x54,0x78, 0x00,	// a 	- 226
0x20,0x54,0x54,0x54,0x78, 0x00,	// a 	- 227
0x20,0x54,0x54,0x54,0x78, 0x00,	// a 	- 228
0x20,0x54,0x54,0x54,0x78, 0x00,	// a 	- 229
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 230
0x38,0x44,0x44,0x44,0x20, 0x00,	// c 	- 231 
0x38,0x54,0x54,0x54,0x18, 0x00,	// e 	- 232
0x38,0x54,0x54,0x54,0x18, 0x00,	// e 	- 233
0x38,0x54,0x54,0x54,0x18, 0x00,	// e 	- 234
0x38,0x54,0x54,0x54,0x18, 0x00,	// e 	- 235
0x00,0x44,0x7D,0x40,0x00, 0x00,	// i 	- 236
0x00,0x44,0x7D,0x40,0x00, 0x00,	// i 	- 237
0x00,0x44,0x7D,0x40,0x00, 0x00,	// i 	- 238
0x00,0x44,0x7D,0x40,0x00, 0x00,	// i 	- 239
0x38,0x44,0x44,0x44,0x38, 0x00,	// o 	- 240
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 241
0x38,0x44,0x44,0x44,0x38, 0x00,	// o 	- 242
0x38,0x44,0x44,0x44,0x38, 0x00,	// o 	- 243
0x38,0x44,0x44,0x44,0x38, 0x00,	// o 	- 244
0x38,0x44,0x44,0x44,0x38, 0x00,	// o 	- 245
0x38,0x44,0x44,0x44,0x38, 0x00,	// o 	- 246
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 247
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 248
0x3C,0x40,0x40,0x20,0x7C, 0x00,	// u 	- 249
0x3C,0x40,0x40,0x20,0x7C, 0x00,	// u 	- 250
0x3C,0x40,0x40,0x20,0x7C, 0x00,	// u 	- 251
0x3C,0x40,0x40,0x20,0x7C, 0x00,	// u 	- 252
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 253
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 254
0x00,0x00,0x00,0x00,0x00, 0x00,	//  	- 255
};						  

/*----------------------------------------------------------------------------
 *      Local variables
 *---------------------------------------------------------------------------*/
unsigned char posicao_line;

/*----------------------------------------------------------------------------
 *      Local functions
 *---------------------------------------------------------------------------*/
void lcdgraf_init (void);
void lcdgraf_Write_Command (unsigned char chip, unsigned char commandByte);
void lcdgraf_Write_Data (unsigned char chip, unsigned char dataByte);
void lcdgraf_gotoxy (unsigned char x, unsigned char y);
void lcdgraf_putc (char databyte, unsigned char reverse);
void lcdgraf_puts (char *buf, unsigned char reverse);
void lcdgraf_showpicture (IMGSCR *buf, unsigned char iniPag);
void lcdgraf_clear (void);
void lcdgraf_putcconst (const char databyte, unsigned char reverse);
void lcdgraf_putsconst (const char *buf, unsigned char reverse);
void lcdgraf_fillname (char *buf, unsigned char reverse);
void lcdgraf_power (unsigned char status);
void lcdgraf_backlight (unsigned char status);

/*-------------------------------------------------------------------------------------------
 * Função: 		lcdgraf_init
 * Descrição: 	Inicializa através de comandos o LCD Gráfico
 * Parâmetros: 	Nenhum
 * Retorno: 	Nenhum
 -------------------------------------------------------------------------------------------*/
void lcdgraf_init (void) 
{
	init_lcd_io ();				
						 
	lcdgraf_backlight (0);

	SPI_Write (0);							// Send data through SPI to shift register 595.

	RESET_IO (0);
	RESET_IO (1);

	lcdgraf_Write_Command (CHIP1, 0x40);	// Set the Y address in the Y address counter
	lcdgraf_Write_Command (CHIP2, 0x40);
   	
	lcdgraf_Write_Command (CHIP1, 0xB8);	// Set the X addres at the X address register
	lcdgraf_Write_Command (CHIP2, 0xB8);
	
   	lcdgraf_Write_Command (CHIP1, 0xC0);	// Indicates the display data RAM displayed at the top of the Screen
	lcdgraf_Write_Command (CHIP2, 0xC0);

	lcdgraf_power (1);						// Liga display LCD

	lcdgraf_clear ();						// Limpa o LCD
}

/*-------------------------------------------------------------------------------------------
 * Função: 		lcdgraf_Write_Command
 * Descrição: 	Envia byte de comando para o LCD
 * Parâmetros: 	chip - Seleciona 1 dos 2 chips do LCD gráfico
 *				commandByte - Comando a ser enviado para o LCD
 * Retorno: 	Nenhum
 -------------------------------------------------------------------------------------------*/
void lcdgraf_Write_Command (unsigned char chip, unsigned char commandByte) 
{
   	RS_IO(0);								// Set pin RS to Low - Write Command 
	if (chip==CHIP1)
		CS_IO (1);							// Set pin CS - Chip Select	1 ou 2
	else 
		CS_IO (0);
	RW_IO(0);								// Set pin RW to Low - Enabled for Write 

	SPI_Write (commandByte);				// Envia comando por SPI para o shift register 595.

   	EN_IO (1);								// Habilita LCD 
   	EN_IO (0);								// Desabilita LCD 
}

/*-------------------------------------------------------------------------------------------
 * Função: 		lcdgraf_Write_Data
 * Descrição: 	Envia byte de dado para o LCD
 * Parâmetros: 	chip - Seleciona 1 dos 2 chips do LCD gráfico
 *				dataByte - Dado a ser enviado para o LCD
 * Retorno: 	Nenhum
 -------------------------------------------------------------------------------------------*/
void lcdgraf_Write_Data (unsigned char chip, unsigned char dataByte) 
{
   	RS_IO(1);								// Set pin RS to High - Write Data
	if (chip==CHIP1)
		CS_IO (1);							// Set pin CS - Chip Select	1 ou 2
	else 
		CS_IO (0);
	RW_IO(0);								// Set pin RW to Low - Enabled for Write 
	
	SPI_Write (dataByte);					// Envia dado por SPI para o shift register 595.

   	EN_IO (1);								// Habilita LCD 
   	EN_IO (0);								// Desabilita LCD 
}

/*-------------------------------------------------------------------------------------------
 * Função: 		lcdgraf_gotoxy
 * Descrição: 	Posiciona o dot a ser modificado do LCD 
 * Parâmetros: 	x - Posição no eixo X
 *				y - Posição no eixo Y
 * Retorno: 	Nenhum
 -------------------------------------------------------------------------------------------*/
void lcdgraf_gotoxy (unsigned char x, unsigned char y)
{
	posicao_line = (x-1)*6;

	// Posição inicial é no CHIP1:
	if (posicao_line<64)
	{
		// Posiciona X e Y do primeiro chip
		lcdgraf_Write_Command(CHIP1, (posicao_line) | 0x40);
		lcdgraf_Write_Command(CHIP1, (y-1) | 0xB8);
		// Posiciona X=0 e Y do segundo chip
		lcdgraf_Write_Command(CHIP2, 0 | 0x40);
		lcdgraf_Write_Command(CHIP2, (y-1) | 0xB8);
	}
	// Posição inicial é no CHIP2:
	else if (posicao_line<128)
	{
		// Posiciona X e Y do segundo chip
		lcdgraf_Write_Command(CHIP2, (posicao_line) | 0x40);
		lcdgraf_Write_Command(CHIP2, (y-1) | 0xB8);
	}
}

/*-------------------------------------------------------------------------------------------
 * Função: 		LCD_putc
 * Descrição: 	Mostra um caractere no LCD na corrente posição do cursor
 * Parâmetros: 	databyte - Byte do caractere
 *				reverse - Opção para inverter cor dos pontos
 * Retorno: 	Nenhum
 -------------------------------------------------------------------------------------------*/
void lcdgraf_putc (char databyte, unsigned char reverse)
{
	unsigned char cont=0;																			 
	
	for(cont=0 ; cont<6 ; cont++,posicao_line++)
	{
		if (posicao_line<64)
		{
			if (reverse)
				lcdgraf_Write_Data(CHIP1,TabelaASC[databyte-32][cont]^0xFF);
			else
				lcdgraf_Write_Data(CHIP1,TabelaASC[databyte-32][cont]);
		}
		else if (posicao_line<128)
		{
			if (reverse)
				lcdgraf_Write_Data(CHIP2,TabelaASC[databyte-32][cont]^0xFF);
			else
				lcdgraf_Write_Data(CHIP2,TabelaASC[databyte-32][cont]);
		}
	}
}

/*-------------------------------------------------------------------------------------------
 * Função: 		lcdgraf_putcconst
 * Descrição: 	Mostra um caractere a partir de constante no LCD na corrente posição do cursor
 * Parâmetros: 	databyte - Byte do caractere
 *				reverse - Opção para inverter cor dos pontos
 * Retorno: 	Nenhum
 -------------------------------------------------------------------------------------------*/
void lcdgraf_putcconst (const char databyte, unsigned char reverse)
{
	unsigned char cont=0;																			 
	for(cont=0 ; cont<6 ; cont++,posicao_line++)
	{
		if (posicao_line<64)
		{
			if (reverse)
				lcdgraf_Write_Data(CHIP1,TabelaASC[databyte-32][cont]^0xFF);
			else
				lcdgraf_Write_Data(CHIP1,TabelaASC[databyte-32][cont]);
		}
		else if (posicao_line<128)
		{
			if (reverse)
				lcdgraf_Write_Data(CHIP2,TabelaASC[databyte-32][cont]^0xFF);
			else
				lcdgraf_Write_Data(CHIP2,TabelaASC[databyte-32][cont]);
		}
	}
}

/*-------------------------------------------------------------------------------------------
 * Função: 		lcdgraf_puts
 * Descrição: 	Mostra um conj de caracteres no LCD na corrente posição do cursor
 * Parâmetros: 	buf - Ponteiro para a área de RAM com os dados
 *				reverse - Opção para inverter cor dos pontos
 * Retorno: 	Nenhum
 -------------------------------------------------------------------------------------------*/
void lcdgraf_puts (char *buf, unsigned char reverse) 
{
   	while (*buf) 
	{
		if (reverse)
      		lcdgraf_putc (*buf++,1);
		else
			lcdgraf_putc (*buf++,0);
   	}
}

/*-------------------------------------------------------------------------------------------
 * Função: 		lcdgraf_putsconst
 * Descrição: 	Mostra um conj de caracteres no LCD na corrente posição do cursor
 * Parâmetros: 	buf - Ponteiro para a área de RAM CONST com os dados
 *				reverse - Opção para inverter cor dos pontos
 * Retorno: 	Nenhum
 -------------------------------------------------------------------------------------------*/
void lcdgraf_putsconst (const char *buf, unsigned char reverse) 
{
   	while (*buf) 
	{
		if (reverse)
			lcdgraf_putcconst (*buf++,1);
		else
      		lcdgraf_putcconst (*buf++,0);
   	}
}

/*-------------------------------------------------------------------------------------------
 * Função: 		lcdgraf_fillname
 * Descrição: 	
 * Parâmetros: 	buf - Ponteiro para a área de RAM com os dados
 *				reverse - Opção para inverter cor dos pontos
 * Retorno: 	Nenhum
 -------------------------------------------------------------------------------------------*/
void lcdgraf_fillname (char *buf, unsigned char reverse)
{
	unsigned char cont=0;

   	while (*buf) 
	{
      	if (reverse)
			lcdgraf_putc (*buf++,1);
		else
			lcdgraf_putc (*buf++,0);
		cont++;
   	}
	while (cont<17)
	{
		if (reverse)
			lcdgraf_putc (' ',1);
		else
			lcdgraf_putc (' ',0);
		cont++;
	}

}

/*-------------------------------------------------------------------------------------------
 * Função: 		lcdgraf_CompileBitmap
 * Descrição: 	Lê arquivo bitmap e formata os dados para mostrar no LCD Gráfico
 * Parâmetros: 	*filebmp - Ponteiro para o arquivo bitmap
 *				*buf - Ponteiro para estrutura com o buffer de destino dos dados
 * Retorno: 	(0) Não foi possível Compilar (1) Compilação OK
 -------------------------------------------------------------------------------------------*/
char lcdgraf_CompileBitmap(FILE *filebmp, IMGSCR *buf)	
{    
	unsigned char file[LEN_BMP_SCR];
	unsigned short lenFile=0;
	int byteFile=0;
	unsigned short offSet;
	unsigned short bitsPixel; 
	unsigned short widthBytes;
	
	unsigned short cntHeight=0;
	unsigned short cntWidth=0;
	unsigned char posBitSrc=0;
	unsigned char byte=0;
	unsigned short cntBitWidth=0;
	unsigned short cntByteDest=0;
    unsigned char posBitDest=0;

	while ((byteFile=fgetc (filebmp)) != EOF)
	{
		file[lenFile++] = (unsigned char) byteFile;
		if (lenFile==LEN_BMP_SCR)  				// Tamanho do arquivo não pode ser maior que o buffer 
			return 0;							// do compilador
	}

    if (file[0]=='B' && file[1]=='M')			// Verifica a assinatura de arquivo bitmap
	{
		offSet = (unsigned short)((file[13]<<24) | (file[12]<<16) | (file[11]<<8) | file[10]);
		buf->width = (unsigned short)((file[21]<<24) | (file[20]<<16) | (file[19]<<8) | file[18]);
		buf->height = (unsigned short)((file[25]<<24) | (file[24]<<16) | (file[23]<<8) | file[22]);
		bitsPixel = (file[29]<<8) | file[28];
	}
	else
		return 0;

	if ((buf->width!=0) && (buf->height!=0) && (buf->width<=128) && (buf->height<=64))	
	{
		if (bitsPixel==1)
		{
			widthBytes = (buf->width +7) / 8;
			while ((widthBytes%4)!=0) widthBytes++;


			for (cntHeight=0 ; cntHeight<buf->height ; cntHeight++)
			{
				for (cntWidth=0 ; cntWidth<widthBytes ; cntWidth++)
				{
				   	for (posBitSrc=128, posBitDest=7 ; posBitSrc!=0 ; posBitSrc/=2 , posBitDest--)
					{
						byte = file [offSet+((cntHeight*widthBytes)+cntWidth)] & posBitSrc;
						if (byte!=0) byte=1;
					
						if (file[BEGIN_COLOR_TABLE + (byte * 4) + 1]>0x80)
							buf->bitmap[cntByteDest] |= (1<<posBitDest);
						else
							buf->bitmap[cntByteDest] &= ~(0<<posBitDest);
					}
					cntByteDest++;
					cntBitWidth++;
					if (cntBitWidth==buf->width)
					{
						cntBitWidth=0;
						while (cntWidth != widthBytes) cntWidth++;
						break;
					}
				}
			}
			if (cntHeight==buf->height)
				return 1;
		}
	}

	return 0;
}   

/*-------------------------------------------------------------------------------------------
 * Função: 		lcdgraf_show

 * Descrição: 	Mostra no LCD a imagem armazenada no buffer
 * Parâmetros: 	iniPag - Pagina inicial do LCD para mostrar o grafico
 * Retorno: 	Nenhum
 -------------------------------------------------------------------------------------------*/
void lcdgraf_showpicture (IMGSCR *buf, unsigned char iniPag)
{
	unsigned char x,y,z,page,ALTERADO,col,bitcol;
	unsigned char *pont;
	
	pont=buf->bitmap;

	page=iniPag;
	col=0;
	ALTERADO=0;
	for(x=0;x<8;x++)
	{
		for (z=128;z!=0;z=z/2)
		{
			page=0;
			bitcol=128;
			for (y=0;y<(64-(iniPag*8));y++)
			{	
				if (pont[y*x] & z)
				//if (picture[y][x] & z)
					ALTERADO |= bitcol;
				bitcol/=2;
				if ((y+1)%8==0)
				{
					lcdgraf_Write_Command(CHIP1,page8-page);
					lcdgraf_Write_Command (CHIP1, 0x40+col);
					lcdgraf_Write_Data(CHIP1,ALTERADO);
					ALTERADO=0;
					page++;
					bitcol=128;
				}
			}
			col++;
		}
	}
	page=iniPag;
	col=0;
	ALTERADO=0;
	for(x=8;x<16;x++)
	{
		for (z=128;z!=0;z=z/2)
		{
			page=0;
			bitcol=128;
			for (y=0;y<(64-(iniPag*8));y++)
			{	
				if (pont[y*x] & z)
				//if (picture[y][x] & z)
					ALTERADO |= bitcol;
				bitcol/=2;
				if ((y+1)%8==0)
				{
					lcdgraf_Write_Command(CHIP2,page8-page);
					lcdgraf_Write_Command (CHIP2, 0x40+col);
					lcdgraf_Write_Data(CHIP2,ALTERADO);
					ALTERADO=0;
					page++;
					bitcol=128;
				}
			}
			col++;
		}
	}
}

/*-------------------------------------------------------------------------------------------
 * Função: 		lcdgraf_clear
 * Descrição: 	Limpa a tela do LCD.
 * Parâmetros: 	nenhum
 * Retorno: 	Nenhum
 -------------------------------------------------------------------------------------------*/

void lcdgraf_clear (void)
{
	unsigned char x,y;

	lcdgraf_Write_Command(CHIP1,page1);	
	for(y=0;y<8;y++)
	{
		lcdgraf_Write_Command(CHIP1,page1+y);	
		for(x=0;x<64;x++)
		{
			lcdgraf_Write_Data(CHIP1,0x00);
		}
	}

	lcdgraf_Write_Command(CHIP2,page1);
	for(y=0;y<8;y++)
	{
		lcdgraf_Write_Command(CHIP2,page1+y);
		for(x=0;x<64;x++)
		{
			lcdgraf_Write_Data(CHIP2,0x00);
		}
	}
}

/*-------------------------------------------------------------------------------------------
 * Função: 		lcdgraf_power
 * Descrição: 	Liga/Desliga o LCD
 * Parâmetros: 	status - (0) Desliga (1) Liga
 * Retorno: 	Nenhum
 -------------------------------------------------------------------------------------------*/

void lcdgraf_power (unsigned char status)
{
	if (status)
	{
		lcdgraf_Write_Command(CHIP1,0x3F);
		lcdgraf_Write_Command(CHIP2,0x3F);
	}
	else
	{
		lcdgraf_Write_Command(CHIP1,0x3E);
		lcdgraf_Write_Command(CHIP2,0x3E);
	}
}

/*-------------------------------------------------------------------------------------------
 * Função: 		lcdgraf_backlight
 * Descrição: 	Muda o estado do LCD 
 * Parâmetros: 	status - (0)desliga backlight, (1) liga backlight
 * Retorno: 	Nenhum
 -------------------------------------------------------------------------------------------*/

void lcdgraf_backlight (unsigned char status) 
{
   	if (status)
   		BKL_IO (0);
	else
   		BKL_IO (1);
}

/*----------------------------------------------------------------------------
 * end of file
 *---------------------------------------------------------------------------*/
